{{ define "log.config.template" -}}
# This is the default configuration file generated by running the official container matrixdotorg/synapse in generate mode as of v1.77.0

######################################
version: 1

formatters:
  precise:
    format: '%(asctime)s - %(name)s - %(lineno)d - %(levelname)s - %(request)s - %(message)s'

handlers:
  console:
    class: logging.StreamHandler
    formatter: precise

loggers:
  synapse.storage.SQL:
    # beware: increasing this to DEBUG will make synapse log sensitive
    # information such as access tokens.
    level: INFO

root:
  level: INFO
  handlers: [console]

######################################
{{- end -}}

{{/* Merge the override values and the template defaults */}}
{{- define "log.config" }}
  {{- $overrideValues := deepCopy (default (fromYaml "{}") .Values.appConfig.log) }}
  {{- $templateValues := fromYaml (include "log.config.template" .) }}
  {{- $mergedValues := mustMergeOverwrite $templateValues $overrideValues }}
  {{- tpl (toYaml $mergedValues) . }}
{{- end }}
